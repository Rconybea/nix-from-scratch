name: dev

on:
  push:
    branches:
    - dev
    - 'feature/**'

  pull_request:
    branches:
    - dev
    - 'feature/**'

env:
  BUILD_TYPE: Release

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: checkout self (nix-from-scratch)
      uses: actions/checkout@v4

    - name: install ubuntu dependencies
      run: |
        PREFIX='${{github.workspace}}/local'
        echo PREFIX=$PREFIX
        echo HOME=$HOME
        echo ubuntu-dep-placeholder

    - name: toplevel config
      run: |
        ./mk/bootstrap.sh --prefix='${{github.workspace}}/local'
        cat mk/prefix.mk

    - name: m4
      run: |
        ./mk/do-github-package-workflow.sh --prefix='${{github.workspace}}/local' --package=m4

    - name: autoconf
      run: |
        ./mk/do-github-package-workflow.sh --prefix='${{github.workspace}}/local' --package=autoconf

    - name: autoconf-archive
      run: |
        ./mk/do-github-package-workflow.sh --prefix='${{github.workspace}}/local' --package=autoconf-archive

    - name: automake
      run: |
        ./mk/do-github-package-workflow.sh --prefix='${{github.workspace}}/local' --package=automake

    - name: pkgconf
      run: |
        ./mk/do-github-package-workflow.sh --prefix='${{github.workspace}}/local' --package=pkgconf

    - name: zlib
      run: |
        ./mk/do-github-package-workflow.sh --prefix='${{github.workspace}}/local' --package=zlib

    - name: flex
      run: |
        ./mk/do-github-package-workflow.sh --prefix='${{github.workspace}}/local' --package=flex

    - name: bison
      run: |
        ./mk/do-github-package-workflow.sh --prefix='${{github.workspace}}/local' --package=bison
