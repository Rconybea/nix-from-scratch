#!/bin/bash

echo
echo "gcc_wrapper=${gcc_wrapper}"
echo "toolchain=${toolchain}"
echo "bash=${bash}"
echo "sed=${sed}"
echo "coreutils=${coreutils}"
echo "sysroot=${sysroot}"
echo

set -e
set -x

export PATH=${gcc_wrapper}/bin:${toolchain}/bin:${bash}/bin:${sed}/bin:${coreutils}/bin

mkdir -p ${out}/src
mkdir -p ${out}/lib

redirect_execve_c2=${out}/src/redirect_execve.c

cp ${redirect_execve_c} ${redirect_execve_c2}

sed -i -e s:@bash_program@:${bash}/bin/bash: ${redirect_execve_c2}

nxfs-gcc -fPIC -shared -o ${out}/lib/libnxfs_redirect_execve.so ${redirect_execve_c2}
