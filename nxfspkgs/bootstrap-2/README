Introduction

Order is important here.  Builders progressively replace stage-1 packages with stage-2 versions.
Stage-2 versions are built from source within nix, using the imported+redirected stage-1 toolchain.

Recap:
- stage-0 imported external bootstrap ingredients as fixed-output derivations
- stage-1 redirected libraries and dynamic linker to refer to their respective nix store versions.

In stage-2 we progressively recompile the bootstrap tools ingredients.
At the end of stage-2 we have a native toolchain compiled within the nix store;
with caveat that we haven't yet used that toolchain to entirely rebuild itself,
so some toolchain components (for example binutils, glibc) were prepared using all or part of the
stage1 imported toolhcain

----------------------------------------------------------------
Dependency Tower

Dependencies somewhat overspecified for the sake of simplicity.
(For example nxfs-zlib-2 needs nxfs-sed-2, but not nxfs-gawk-2)



 +----------------------------------------------------------------------------------------------------+
 | -A gcc-wrapper-2                           nxfs-gcc-wrapper-2                                      |
 +----------------------------------------------------------------------------------------------------+
 | -A gcc-x3-2                                nxfs-gcc-stage2-2                                       |
 +----------------------------------------------------------------------------------------------------+
 | -A gcc-x2-wrapper-2                        nxfs-gcc-stage3-wrapper-2                               |
 +----------------------------------------------------------------------------------------------------+
 | -A libstdcxx-x1-2                          nxfs-libstdcxx-stage2-2                                 |
 +----------------------------------------------------------------------------------------------------+
 | -A gcc-x1-wrapper-2                        nxfs-gcc-stage2-wrapper-2                               |
 +----------------------------------------------------------------------------------------------------+
 | -A gcc-x1-2                                nxfs-gcc-stage1-2                                       |
 +----------------------------------------------------+-----------------------------------------------+
 | -A binutils-x0-wrapper-2 nxfs-binutils-x0-wrapper-2| -A gcc-x0-wrapper-2 nxfs-gcc-stage1-wrapper-2 |
 +----------------------------------------------------+-----------------------------------------------+
 | -A stage2pkgs.glibc-2                      nxfs-glibc-stage1-2                                     |
 +-----------------+--------------------------------+---------------+---------------+-----------------+
 | -A stage2pkgs   | -A stage2pkgs.texinfo-2        | -A stage2pkgs | -A stage2pkgs | -A stage2pkgs   |
 |    .binutils-2  |                                |    .mpc-2     |    .python-2  |    .gzip-2      |
 |                 |         nxfs-texinfo-2         |               |               | nxfs-gzip-2     |
 |                 |                                | nxfs-mpc-2    |               |                 |
 |                 +-----------------+--------------+---------------+               | -A stage2pkgs   |
 |                 | -A stage2pkgs   |-A stage2pkgs | -A stage2pkgs |               |    .patch-2     |
 | nxfs-binutils-2 |    .automake-2  |   .bison-2   |    .mpfr-2    |               | nxfs-patch-2    |
 |                 |                 |              |               |               |                 |
 |                 | nxfs-automake-2 | nxfs-bison-2 | nxfs-mpfr-2   | nxfs-python-2 | -A stage2pkgs   |
 |                 +-----------------+--------------+---------------+               |    .gperf-2     |
 |                 | -A stage2pkgs   |-A stage2pkgs | -A stage2pkgs |               | nxfs-gperf-2    |
 |                 |    .autoconf-2  |   .flex-2    |    .gmp-2     |               |                 |
 |                 |                 |              |               |               | -A stage2pkgs   |
 |                 | nxfs-autoconf-2 | nxfs-flex-2  | nxfs-gmp-2    |               |    .patchelf-2  |
 +-----------------------------------+------+-------+---------------+---------------+ nxfs-patchelf-2 |
 | -A stage2pkgs.perl-2     nxfs-perl-2     | -A stage2pkgs.file-2  | -A stage2pkgs |                 |
 | -A stage2pkgs.m4-2       nxfs-m4-2       |                       |    .zlib-2    |                 |
 +------------------------------------------+                       |               |                 |
 | -A stage2pkgs.pkgconf-2  nxfs-pkgconf-2  |      nxfs-file-2      |  nxfs-zlib-2  |                 |
 +------------------------------------------+-----------------------+---------------+-----------------+
 | -A stage2pkgs.coreutils-2                  nxfs-coreutils-2                                        |
 +----------------------------------------------------------------------------------------------------+
 | -A stage2pkgs.gnumake-2                    nxfs-gnumake-2                                          |
 +----------------------------------------------------------------------------------------------------+
 | -A stage2pkgs.gawk-2                       nxfs-gawk-2                                             |
 +----------------------------------------------------------------------------------------------------+
 | -A stage2pkgs.popen-2                      nxfs-popen-2                                            |
 +----------------------------------------------------------------------------------------------------+
 | -A stage2pkgs.popen-template-2             nxfs-popen-template-2                                   |
 +----------------------------------------------------------------------------------------------------+
 | -A stage2pkgs.bash-2                       nxfs-bash-2                                             |
 +----------------------------------------------------------------------------------------------------+
 | -A stage2pkgs.ncurses-2                    nxfs-ncurses-2                                          |
 +----------------------------------------------------------------------------------------------------+
 | -A stage2pkgs.gnutar-2                     nxfs-tar-2                                              |
 +----------------------------------------------------------------------------------------------------+
 | -A stage2pkgs.gnugrep-2                    bootstrap-pkgs/gnugrep                                  |
 +----------------------------------------------------------------------------------------------------+
 | -A stage2pkgs.gnused-2                     bootstrap-pkgs/gnused                                   |
 +----------------------------------------------------------------------------------------------------+
 | -A stage2pkgs.findutils-2                  bootstrap-pkgs/findutils                                |
 +----------------------------------------------------------------------------------------------------+
 | -A stage2pkgs.diffutils-2                  bootstrap-pkgs/diffutils                                |
 +----------------------------------------------------------------------------------------------------+
 | -A stage2pkgs.which-2                      bootstrap-pkgs/which                                    |
 +----------------------------------------------------------------------------------------------------+
 | -A stage2pkgs.linux-headers-2              bootstrap-pkgs/linux-headers                            |
 +----------------------------------------------------------------------------------------------------+
 |                                            bootstrap-1                                             |
 +----------------------------------------------------------------------------------------------------+

nxfs-gcc-wrapper-2 gcc/g++ wrapper scripts to inject nix-store paths

NOTE:
1. Dependency nxfs-gnumake-2 <- nxfs-bash-2 is load-bearing.
The builtin $(shell ..) feature of gnumake would by default invoke /bin/sh.
That's true of the gnumake adopted into nix store from bootstrap/nxfs-gnumake-1.
We need to build a gnumake for which $(shell ..) invokes a nix-store-owned shell,
such as the one prepared by nxfs-bash-2.
ls

2. Dependency nxfs-gawk-2 <- nxfs-bash-2 is load-bearing.
The gawk i/o implemented by hardwiring calls like
  execl("/bin/sh", "sh", "-c", ...)
We need these to refer to nix-store-owned bash instead, for this to work from within
nix-build. Although bash needs gawk to build, it doesn't rely on this feature.
We can build nxfs-bash-2 with stage1 gawk, then build nxfs-gawk-2 using nxfs-bash-2.

3. Dependency nxfs-gawk-2 <- nxfs-system-2 is vital.
nxfs-system-2 is source-only.  It contains a single function nxfs_system().
nxfs_system() is similar to glibc system(), except that it invokes nix-store-owned bash
from nxfs-bash-2, instead of /bin/sh.  nxfs-gawk-2 splices in this function to implement
the gawk system() builtin.  This is necessary for said builtin to work when invoked
in a chrooted nix-build,  in particular for building glibc.

4. We're using builtins.fetchTarball here. This is not optional, since we don't have nixpkgs.fetchTarball
yet.  One (tragic) consequence of using the builtin version is: since it runs at evaluation time
(before nix decides which derivations to build) it cannot run in parallel with other nix expressions
or builds.
